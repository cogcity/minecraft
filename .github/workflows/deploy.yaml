name: "Deploy to Server"

on:
    workflow_dispatch:
    workflow_call:
    push:
        branches: 
            - main
jobs: 
    deploy:
        runs-on: ubuntu-22.04
        steps:
            - name: Setup Tailscale
              uses: tailscale/github-action@v1
              with:
                authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

            - name: Setup SSH Key
              run: |-
                mkdir ~/.ssh
                echo "${{ secrets.KEY }}" > ~/.ssh/id_ed25519
            
            - name: Connect to Server
              shell: bash
              run: |-
                ssh morgan <<\EOF
                11
                cd ${{ secrets.DIR }}
                git pull
                docker compose exec minecraft rcon-cli me [Server will automatically restart in 30s]
                sleep 30
                docker compose up -d
                
                EOF
